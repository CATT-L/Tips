<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="http://tva1.sinaimg.cn/large/8697b072gy1h6njz4podsj2046046glf.jpg"><title>Service 业务层 | Hyperf 框架规范</title><meta name="description" content=" ">
    <link rel="modulepreload" href="/hyperf-reference/assets/app.297635da.js"><link rel="modulepreload" href="/hyperf-reference/assets/service.html.b6de496c.js"><link rel="modulepreload" href="/hyperf-reference/assets/service.html.ecb83344.js"><link rel="prefetch" href="/hyperf-reference/assets/index.html.ba687ed3.js"><link rel="prefetch" href="/hyperf-reference/assets/command.html.e7f84f14.js"><link rel="prefetch" href="/hyperf-reference/assets/controller.html.f9f0c3f5.js"><link rel="prefetch" href="/hyperf-reference/assets/crontab.html.ba1b69cc.js"><link rel="prefetch" href="/hyperf-reference/assets/dao.html.12b845ce.js"><link rel="prefetch" href="/hyperf-reference/assets/entity.html.80029b1f.js"><link rel="prefetch" href="/hyperf-reference/assets/index.html.fe27fa4a.js"><link rel="prefetch" href="/hyperf-reference/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/hyperf-reference/assets/index.html.b40ea19d.js"><link rel="prefetch" href="/hyperf-reference/assets/command.html.74d14b1d.js"><link rel="prefetch" href="/hyperf-reference/assets/controller.html.ac1d9d1e.js"><link rel="prefetch" href="/hyperf-reference/assets/crontab.html.7a23e124.js"><link rel="prefetch" href="/hyperf-reference/assets/dao.html.f0b1d16b.js"><link rel="prefetch" href="/hyperf-reference/assets/entity.html.59b4d572.js"><link rel="prefetch" href="/hyperf-reference/assets/index.html.bbfaa4d7.js"><link rel="prefetch" href="/hyperf-reference/assets/404.html.d543e0e7.js">
    <link rel="stylesheet" href="/hyperf-reference/assets/style.d9f5775d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/hyperf-reference/" class=""><img class="logo" src="http://tva1.sinaimg.cn/large/8697b072gy1h6njz4podsj2046046glf.jpg" alt="Hyperf 框架规范"><span class="site-name can-hide">Hyperf 框架规范</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="http://myappgo.com:1180/xiaoetech/wiki-hyperf-reference" rel="noopener noreferrer" target="_blank" aria-label="Source"><!--[--><!--]--> Source <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="http://myappgo.com:1180/xiaoetech/wiki-hyperf-reference" rel="noopener noreferrer" target="_blank" aria-label="Source"><!--[--><!--]--> Source <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">概述 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/hyperf-reference/" class="sidebar-item" aria-label="大纲"><!--[--><!--]--> 大纲 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">入口 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/hyperf-reference/reference/enter-point/controller.html" class="sidebar-item" aria-label="Controller 控制器"><!--[--><!--]--> Controller 控制器 <!--[--><!--]--></a><!----></li><li><a href="/hyperf-reference/reference/enter-point/command.html" class="sidebar-item" aria-label="Command 命令"><!--[--><!--]--> Command 命令 <!--[--><!--]--></a><!----></li><li><a href="/hyperf-reference/reference/enter-point/crontab.html" class="sidebar-item" aria-label="Crontab 定时任务"><!--[--><!--]--> Crontab 定时任务 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">业务 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Service 业务层"><!--[--><!--]--> Service 业务层 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#基本概念" class="router-link-active router-link-exact-active sidebar-item" aria-label="基本概念"><!--[--><!--]--> 基本概念 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#目录规范" class="router-link-active router-link-exact-active sidebar-item" aria-label="目录规范"><!--[--><!--]--> 目录规范 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#多端前缀" class="router-link-active router-link-exact-active sidebar-item" aria-label="多端前缀"><!--[--><!--]--> 多端前缀 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#功能模块" class="router-link-active router-link-exact-active sidebar-item" aria-label="功能模块"><!--[--><!--]--> 功能模块 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#代码规范" class="router-link-active router-link-exact-active sidebar-item" aria-label="代码规范"><!--[--><!--]--> 代码规范 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#返回-resultvo-值对象" class="router-link-active router-link-exact-active sidebar-item" aria-label="返回 ResultVo 值对象"><!--[--><!--]--> 返回 ResultVo 值对象 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#函数名和变量名" class="router-link-active router-link-exact-active sidebar-item" aria-label="函数名和变量名"><!--[--><!--]--> 函数名和变量名 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#代码引用限制" class="router-link-active router-link-exact-active sidebar-item" aria-label="代码引用限制"><!--[--><!--]--> 代码引用限制 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#配置-config-读取方式" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置 config 读取方式"><!--[--><!--]--> 配置 config 读取方式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/hyperf-reference/reference/service/service.html#不要在代码中用-env-函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="不要在代码中用 env 函数"><!--[--><!--]--> 不要在代码中用 env 函数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">模型 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/hyperf-reference/reference/model/" class="sidebar-item" aria-label="Model 模型"><!--[--><!--]--> Model 模型 <!--[--><!--]--></a><!----></li><li><a href="/hyperf-reference/reference/model/entity.html" class="sidebar-item" aria-label="Model-Entity 数据实体"><!--[--><!--]--> Model-Entity 数据实体 <!--[--><!--]--></a><!----></li><li><a href="/hyperf-reference/reference/model/dao.html" class="sidebar-item" aria-label="Model-Dao 数据访问对象"><!--[--><!--]--> Model-Dao 数据访问对象 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="service-业务层" tabindex="-1"><a class="header-anchor" href="#service-业务层" aria-hidden="true">#</a> Service 业务层</h1><div class="custom-container warning"><p class="custom-container-title">注意</p><p>下列提到的项目信息仅供示范，以实际项目为准</p></div><h2 id="基本概念" tabindex="-1"><a class="header-anchor" href="#基本概念" aria-hidden="true">#</a> 基本概念</h2><p>业务层用于编写实际的业务逻辑。</p><h2 id="目录规范" tabindex="-1"><a class="header-anchor" href="#目录规范" aria-hidden="true">#</a> 目录规范</h2><p>业务位于 Service 目录下。</p><h3 id="多端前缀" tabindex="-1"><a class="header-anchor" href="#多端前缀" aria-hidden="true">#</a> 多端前缀</h3><p>此处目录前缀规范与 Controller 控制器一致。</p><h3 id="功能模块" tabindex="-1"><a class="header-anchor" href="#功能模块" aria-hidden="true">#</a> 功能模块</h3><p>此处目录规范与 Controller 控制器一直。</p><p>文件名均以 Service.php 为后缀。</p><p>例：</p><p>管理后台-活动参与-查询的目录，可以有下面几种分法</p><p><code>/app/Service/Manage/Activity/ActivityRecordQueryService.php</code></p><p><code>/app/Service/Manage/Activity/Record/RecordQueryService.php</code></p><p><code>/app/Service/Manage/Activity/RecordQueryService.php</code></p><h4 id="单一功能原则" tabindex="-1"><a class="header-anchor" href="#单一功能原则" aria-hidden="true">#</a> 单一功能原则</h4><p>在逻辑较为复杂的情况下，一个Service应当专注完成一种甚至是一个业务逻辑。</p><p>也就是说，一个类只有一个操作是可能的。</p><p>不必担心这种设计会让代码看起来很简陋，因为一个复杂的逻辑，必定包含大量的私有方法。因此，在这种情况下，即使一个类中只有一个操作（公有方法），但由于有多个私有方法，所以实际上它并不简陋。</p><h5 id="例-一种业务逻辑的情况" tabindex="-1"><a class="header-anchor" href="#例-一种业务逻辑的情况" aria-hidden="true">#</a> 例：一种业务逻辑的情况</h5><p>查询相关放在 *QueryService.php 里</p><p>导出相关放在 *ExportService.php 里</p><h5 id="例-一个业务逻辑的情况" tabindex="-1"><a class="header-anchor" href="#例-一个业务逻辑的情况" aria-hidden="true">#</a> 例： 一个业务逻辑的情况</h5><p>活动报名订单支付 ActivityOrderPayService::handle</p><h2 id="代码规范" tabindex="-1"><a class="header-anchor" href="#代码规范" aria-hidden="true">#</a> 代码规范</h2><h3 id="返回-resultvo-值对象" tabindex="-1"><a class="header-anchor" href="#返回-resultvo-值对象" aria-hidden="true">#</a> 返回 ResultVo 值对象</h3><p>Service层的公有函数，返回 ResultVo 值对象。</p><h3 id="函数名和变量名" tabindex="-1"><a class="header-anchor" href="#函数名和变量名" aria-hidden="true">#</a> 函数名和变量名</h3><p>函数名和变量名，统一使用驼峰命名法，通常首字母小写。</p><p>常量，采用全大写的下划线命名。</p><p>例外：</p><ul><li>成员变量，如果它的用途是一个配置，那么采用下划线命名法。</li><li>对象注入，为了方便复制，其变量名通常与注入类名一致，自然而然首字母也是大写。</li></ul><p>常用词缩写视为正常单词，例如 Json、Xml、Html、Id、Tcp。</p><p>不要随意制造缩写，不然其他人看不懂，名字长一点也没有问题的，反正有自动补全。</p><p><strong>反例：</strong></p><ul><li>拒付：dishonor -&gt; dis</li></ul><p>优先采用英语命名，若实在想不到符合含义的英文名称，可退而采用拼音命名。</p><p>变量、方法名限制使用ASCII字符。</p><p>public 函数、变量无前缀，例： <code>Foo::bar()</code>。</p><p>protected 函数、变量单下划线前缀，例：<code>Foo::_bar()</code> 。</p><p>private 函数、变量双下划线前缀，例：<code>Foo::__bar()</code> 。</p><h3 id="代码引用限制" tabindex="-1"><a class="header-anchor" href="#代码引用限制" aria-hidden="true">#</a> 代码引用限制</h3><p>Service层不能调用比自己上一层的代码，例如所有的入口代码</p><ul><li><p>Controller 控制器</p></li><li><p>Command 命令</p></li><li><p>Process 进程</p></li><li><p>Crontab 定时任务</p></li><li><p>……</p></li></ul><p>Service层可以调用同一层级（即Service层）的代码，但不提倡注入成员变量，容易产生循环依赖。</p><p>可以通过<code>di</code>函数获取指定对象并调用。</p><p>Service层可以调用下层级的代码，例如Model层的代码，提倡注入，也可以用 <code>di</code> 函数。</p><ul><li>Dao 数据访问对象</li><li>Entity 数据实体</li><li>……</li></ul><h3 id="配置-config-读取方式" tabindex="-1"><a class="header-anchor" href="#配置-config-读取方式" aria-hidden="true">#</a> 配置 config 读取方式</h3><p>配置读取统一采用 @Value 注入，不建议用 config 函数。</p><p>因为注入可以在启动的时候检查，有无疏漏的配置，config 函数只有执行到才能发现问题。</p><p>例：</p><div class="language-php ext-php line-numbers-mode"><pre class="language-php"><code><span class="token keyword">class</span> <span class="token class-name-definition class-name">ImageActionService</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@var</span> <span class="token class-name"><span class="token keyword">string</span></span>
     * @Value(key=&quot;app_base_url&quot;)
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$app_base_url</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@var</span> <span class="token class-name"><span class="token keyword">string</span></span>
     * @Value(key=&quot;qiniu.default.access_key&quot;)
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$access_key</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@var</span> <span class="token class-name"><span class="token keyword">string</span></span>
     * @Value(key=&quot;qiniu.default.secret_key&quot;)
     */</span>
    <span class="token keyword">protected</span> <span class="token variable">$secret_key</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="不要在代码中用-env-函数" tabindex="-1"><a class="header-anchor" href="#不要在代码中用-env-函数" aria-hidden="true">#</a> 不要在代码中用 env 函数</h3><p>在 /config/ 目录下的配置，可以用 env 函数读取环境变量。</p><p>但 /app/ 下的代码，应当读取 /config/ 目录下的配置，而不是直接通过 env 读取。</p><p>这是为了避免不必要的混乱。</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="http://myappgo.com:1180/xiaoetech/wiki-hyperf-reference/-/edit/develop/docs/reference/service/service.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/hyperf-reference/assets/app.297635da.js" defer></script>
  </body>
</html>
